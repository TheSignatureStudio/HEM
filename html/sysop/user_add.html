<div class="content-area">
    <div class="content-box">
        <div class="board-header">
            <h2 class="board-title">회원 등록</h2>
        </div>

        <form class="post-write-form" name="form1" method="post">
            <div class="form-group">
                <label class="form-label" for="name">이름</label>
                <input type="text" id="name" name="name" class="form-input" placeholder="이름을 입력하세요" required>
            </div>

            <div class="form-group">
                <label class="form-label" for="username">아이디</label>
                <div style="display: flex; align-items: center; flex: 1;">
                    <input type="text" id="username" name="username" class="form-input" placeholder="아이디를 입력하세요" required>
                    <span id="username_check_msg" class="check-msg"></span>
                </div>
            </div>

            <div class="form-group">
                <label class="form-label" for="password">비밀번호</label>
                <input type="password" id="password" name="password" class="form-input" placeholder="비밀번호를 입력하세요" required>
            </div>

            <div class="form-group">
                <label class="form-label" for="password_confirm">비밀번호 확인</label>
                <input type="password" id="password_confirm" name="password_confirm" class="form-input" placeholder="비밀번호를 다시 입력하세요" required>
            </div>
            <div class="form-group">
                <label class="form-label" for="email">이메일</label>
                <input type="email" id="email" name="email" class="form-input" placeholder="이메일을 입력하세요" required>
            </div>

            <div class="form-group">
                <label class="form-label" for="phone">전화번호</label>
                <input type="text" id="phone" name="phone" class="form-input" placeholder="전화번호를 입력하세요">
            </div>


            <div class="form-group">
                <label class="form-label" for="role">역할</label>
                <select id="role" name="role" class="form-input">
                    <option value="0">일반사용자</option>
                    <option value="1">관리자</option>
                </select>
            </div>

            <div class="form-group">
                <label class="form-label" for="status">상태</label>
                <select id="status" name="status" class="form-input">
                    <option value="1">활성화</option>
                    <option value="0">비활성화</option>
                </select>
            </div>

            <div class="button-group" style="justify-content: flex-end;">
                <button type="button" class="button button-cancel"><a href="/sysop/user_list.jsp">취소</a></button>
                <button type="submit" class="button button-submit">등록</button>
            </div>
        </form>
        {{form_script}}
    </div>
</div>

<script src="https://code.jquery.com/jquery-3.6.4.min.js"></script>
<script>
$(document).ready(function() {
    $('#username').on('blur', function() { // 입력 필드에서 포커스를 잃었을 때
        var username = $(this).val();
        var msgSpan = $('#username_check_msg');

        msgSpan.html(''); // 이전 메시지 지우기

        if (username.length > 0) {
            // msgSpan.html('확인 중...'); // 로딩 표시 (선택 사항)
            $.get('/sysop/user_add.jsp', { mode: 'CHECK', v: username }, function(response) {
                msgSpan.html(response); // 서버 응답(메시지) 표시
            });
        }
    });

    // 폼 제출 시 비밀번호 확인 로직 (선택 사항)
    $('form[name="form1"]').on('submit', function(e) {
        var password = $('#password').val();
        var passwordConfirm = $('#password_confirm').val();
        if (password !== passwordConfirm) {
            alert('비밀번호가 일치하지 않습니다.');
            $('#password_confirm').focus();
            e.preventDefault(); // 폼 제출 중단
            return false;
        }
        // 아이디 중복 여부 최종 확인 (선택 사항)
        if ($('#username_check_msg .bad').length > 0) {
            alert('사용 중인 아이디입니다. 다른 아이디를 입력해주세요.');
            $('#username').focus();
             e.preventDefault(); // 폼 제출 중단
            return false;
        }
    });

    // 전화번호 자동 하이픈 추가
    $('#phone').on('input', function() {
        var phone = $(this).val().replace(/[^0-9]/g, ''); // 숫자만 남김
        if (phone.length > 3 && phone.length <= 7) {
            // 010-1234
            phone = phone.substr(0, 3) + '-' + phone.substr(3);
        } else if (phone.length > 7) {
            // 010-1234-5678
            phone = phone.substr(0, 3) + '-' + phone.substr(3, 4) + '-' + phone.substr(7);
        }
        $(this).val(phone);
    });
});
</script>
